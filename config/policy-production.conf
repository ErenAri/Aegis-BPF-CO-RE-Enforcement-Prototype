# AegisBPF Production Policy
#
# This policy is designed for production deployment.
# It follows the principle of least surprise - only deny access to
# highly sensitive files that should never be accessed by normal applications.
#
# Deployment: Start with this minimal policy in Phase 1 (Shadow Mode),
# then expand based on observed access patterns.

version=1

# Deny access to sensitive system files
[deny_path]
# Critical authentication files
/etc/shadow
/etc/shadow-
/etc/gshadow
/etc/gshadow-

# SSH host keys (prevent key theft)
/etc/ssh/ssh_host_dsa_key
/etc/ssh/ssh_host_ecdsa_key
/etc/ssh/ssh_host_ed25519_key
/etc/ssh/ssh_host_rsa_key

# Root SSH keys
/root/.ssh/id_rsa
/root/.ssh/id_dsa
/root/.ssh/id_ecdsa
/root/.ssh/id_ed25519

# Sudoers configuration (prevent privilege escalation)
/etc/sudoers
/etc/sudoers.d/10-installer
/etc/sudoers.d/README

# PAM authentication
/etc/pam.d/common-auth
/etc/pam.d/common-password

# Add environment-specific sensitive paths here
# Examples:
# /var/secrets/database.key
# /opt/app/config/production.key
# /home/deploy/.aws/credentials

# Allow specific cgroups to access sensitive files
# (e.g., backup services, administrative tasks)
[allow_cgroup]
# System services that need access
/system.slice/sshd.service
/system.slice/systemd-logind.service

# Backup services (if needed)
# /system.slice/backup.service

# Add authorized cgroups here based on Phase 1 analysis

# Network deny rules (optional - enable after Phase 1 analysis)
# Uncomment and customize based on your security requirements
#
# [deny_ip]
# 169.254.169.254
#
# [deny_port]
# tcp:22:egress
# tcp:3306:egress

# Notes for operators:
# 1. This is a MINIMAL starting policy for Phase 1 (Shadow Mode)
# 2. Monitor aegisbpf stats --detailed during shadow mode
# 3. Review blocks by path/cgroup to identify patterns
# 4. Expand deny rules based on threat model
# 5. Add allow rules for legitimate services that need access
# 6. Test thoroughly in Phase 2 (Test Environment) before enforcement
